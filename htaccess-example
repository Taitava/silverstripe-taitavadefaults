### TAITAVA'S DEFAULT SILVERSTRIPE HTACCESS RULES START ###
RewriteEngine on

# Redirect domain.webhallinta.fi -> domain.webhallinta.fi/admin
RewriteCond %{HTTP_HOST} \.webhallinta\.fi$ [NC]
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^$ https://%{HTTP_HOST}/admin [L]

# Redirect http://domain.webhallinta.fi/* -> httpS://domain.webhallinta.fi/*
RewriteCond %{HTTP_HOST} \.webhallinta\.fi$ [NC]
RewriteCond %{HTTPS} !=on
RewriteRule ^.*$ https://%{HTTP_HOST}/$0 [L]

# Redirect http://domain.webtestaus.fi/{security|admin|dev} -> httpS://domain.webtestaus.fi/{security|admin|dev}
RewriteCond %{HTTP_HOST} \.webtestaus\.fi$ [NC]
RewriteCond %{HTTPS} !=on
RewriteRule ^(security|admin|dev)\/ https://%{HTTP_HOST}/$0 [NC,L]

# Deny access to {security|admin|dev} if HTTPS is not used
RewriteCond %{HTTPS} !=on
RewriteRule ^(security|admin|dev)\/ - [NC,L]
### TAITAVA'S DEFAULT SILVERSTRIPE HTACCESS RULES END ###

RewriteCond %{HTTP_HOST} ^turunvalkonauha\.taitavasti\.fi$ [NC]
RewriteRule ^.*$ http://www.turunvalkonauha.fi/$0 [L]

### SILVERSTRIPE START ###
# Deny access to templates (but allow from localhost)
<Files *.ss>
	Order deny,allow
	Deny from all
	Allow from 127.0.0.1
</Files>

# Deny access to IIS configuration
<Files web.config>
	Order deny,allow
	Deny from all
</Files>

# Deny access to YAML configuration files which might include sensitive information
<Files *.yml>
	Order allow,deny
	Deny from all
</Files>

# Route errors to static pages automatically generated by SilverStripe
ErrorDocument 404 /assets/error-404.html
ErrorDocument 500 /assets/error-500.html

<IfModule mod_rewrite.c>

	# Turn off index.php handling requests to the homepage fixes issue in apache >=2.4
	<IfModule mod_dir.c>
		DirectoryIndex disabled
	</IfModule>

	SetEnv HTTP_MOD_REWRITE On
	RewriteEngine On
	RewriteBase '/'

	RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]


	# Deny access to potentially sensitive files and folders
	RewriteRule ^vendor(/|$) - [F,L,NC]
	RewriteRule silverstripe-cache(/|$) - [F,L,NC]
	RewriteRule composer\.(json|lock) - [F,L,NC]

	# Process through SilverStripe if no file with the requested name exists.
	# Pass through the original path as a query parameter, and retain the existing parameters.
	RewriteCond %{REQUEST_URI} ^(.*)$
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteRule .* framework/main.php?url=%1 [QSA]
</IfModule>
### SILVERSTRIPE END ###
